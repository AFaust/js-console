(function(){var dataelem="#logtail-data";var pausetoggle="#pause";var scrollelems=["html","body"];var url="http://localhost:9080/alfresco.log";var fix_rn=true;var load=30*1024;var poll=1000;var kill=false;var loading=false;var pause=false;var reverse=true;var log_data="";var log_size=0;function get_log(){if(kill|loading){return;}loading=true;var range;if(log_size===0){range="-"+load.toString();}else{range=(log_size-1).toString()+"-";}$.ajax(url,{dataType:"text",cache:false,headers:{Range:"bytes="+range},success:function(data,s,xhr){loading=false;var size;if(xhr.status===206){if(data.length>load){throw"Expected 206 Partial Content";}var c_r=xhr.getResponseHeader("Content-Range");if(!c_r){throw"Server did not respond with a Content-Range";}size=parseInt(c_r.split("/")[1]);if(isNaN(size)){throw"Invalid Content-Range size";}}else{if(xhr.status===200){if(log_size>1){throw"Expected 206 Partial Content";}size=data.length;}}var added=false;if(log_size===0){if(data.length<size){var start=data.indexOf("\n");log_data=data.substring(start+1);}else{log_data=data;}added=true;}else{log_data+=data.substring(1);if(log_data.length>load){var start=log_data.indexOf("\n",log_data.length-load);log_data=log_data.substring(start+1);}if(data.length>1){added=true;}}log_size=size;if(added){show_log(added);}setTimeout(get_log,poll);},error:function(xhr,s,t){loading=false;if(xhr.status===416||xhr.status==404){log_size=0;log_data="";show_log();setTimeout(get_log,poll);}else{if(s=="error"){error(xhr.statusText);}else{error("AJAX Error: "+s);}}}});}function scroll(where){}function show_log(){if(pause){return;}var t=log_data;if(reverse){var t_a=t.split(/\n/g);t_a.reverse();if(t_a[0]==""){t_a.shift();}t=t_a.join("\n");}if(fix_rn){t=t.replace(/\n/g,"\r\n");}TermGlobals.importEachLine(t);if(!reverse){scroll(-1);}}function error(what){kill=true;$(dataelem).text("An error occured :-(.\r\nReloading may help; no promises.\r\n"+what);scroll(0);}$(document).ready(function(){var hash=location.search.replace(/^\?/,"");if(hash=="noreverse"){reverse=false;}$(pausetoggle).click(function(e){pause=!pause;$(pausetoggle).text(pause?"Unpause":"Pause");show_log();e.preventDefault();});get_log();});})();